{% extends "base.html" %}
{% block title %}MUS-HUB | Home{% endblock %}

{% block content %}
<h2>Welcome, {{ username }}!</h2>
<a href="{{ url_for('profile') }}">Go to Profile</a>

<!-- Flash Messages -->
{% with messages = get_flashed_messages() %}
    {% if messages %}
        <ul class="flashes">
        {% for message in messages %}
            <li>{{ message }}</li>
        {% endfor %}
        </ul>
    {% endif %}
{% endwith %}

<h2>Latest Updates</h2>

{% for content in contents %}
    <div class="upload">
        <h3>Uploaded File: {{ content.FilePath }}</h3>
        <p>Upload Date: {{ content.UploadDate.strftime('%Y-%m-%d %H:%M:%S') }}</p>

        <!-- Media Player -->
        {% set ext = content.FilePath.split('.')[-1].lower() %}
        {% if ext in ['mp3', 'wav', 'ogg'] %}
            <audio controls>
                <source src="{{ url_for('static', filename='uploads/' ~ content.FilePath) }}" type="audio/{{ ext }}">
                Your browser does not support audio playback.
            </audio>
        {% elif ext in ['mp4', 'webm', 'ogg'] %}
            <video controls width="360">
                <source src="{{ url_for('static', filename='uploads/' ~ content.FilePath) }}" type="video/{{ ext }}">
                Your browser does not support video playback.
            </video>
        {% else %}
            <p>Preview not available for this file type.</p>
        {% endif %}

        <!-- Comments -->
        <h4>Comments:</h4>
        <ul>
            {% for comment in content.comments %}
                <li>
                    <strong>{{ comment.user.Username }}</strong>: {{ comment.CommentText }}
                    <small>({{ comment.CommentDate.strftime('%Y-%m-%d %H:%M:%S') }})</small>
                </li>
            {% endfor %}
        </ul>

        <!-- Comment Form -->
        <form action="{{ url_for('add_comment', content_id=content.ContentID) }}" method="POST">
            <textarea name="comment_text" placeholder="Leave a comment..." required></textarea>
            <button type="submit">Submit Comment</button>
        </form>
    </div>
{% endfor %}
{% endblock %}

<!-- Link to index.css -->
<link rel="stylesheet" href="{{ url_for('static', filename='index.css') }}">
